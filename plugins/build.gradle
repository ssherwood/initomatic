subprojects {
    jar {
        manifest {
            attributes 'Plugin-Class': "${pluginClass}",
                    'Plugin-Id': "${pluginId}",
                    'Plugin-Version': "${version}",
                    'Plugin-Provider': "${pluginProvider}"
        }
    }

    task plugin(type: Jar) {
        version = "0.0.1-SNAPSHOT"
        baseName = "plugin-${pluginId}"
        into('classes') {
            with jar
        }
        into('lib') {
            from configurations.compile
        }
        extension('zip')
    }

    task assemblePlugin(type: Copy) {
        from plugin
        into pluginsDir
    }

    task assemblePlugins(type: Copy) {
        dependsOn assemblePlugin
    }

    build.dependsOn project.tasks.assemblePlugins

    // common plugin dependencies
    dependencies {
        // compileOnly important!!!
        // We do not want to put the api into the zip file since the main program has it already!
        compileOnly project(':shared:initomatic-api')
    }
}